CREATE VIEW `recipe_permission_view` AS SELECT b.id || '_' || r.id as id, r.chef_id as `recipe_chef_id`, b.chef_id as `book_chef_id`, b.collaborators as `collaborators`, CASE when r.private = 0 and b.private = 0 and b.book_type != 'P' then 'public' else 'private' end as `state`, r.id as recipe_id FROM recipes r JOIN books_has_recipes br ON r.id = br.recipe_id JOIN books b ON b.id = br.book_id;